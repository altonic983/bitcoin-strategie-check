<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BTC 5€ Strategie</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BTC 5€">
    <link rel="apple-touch-icon" href="https://cryptologos.cc/logos/bitcoin-btc-logo.png">
    <meta name="mobile-web-app-capable" content="yes">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Verhindert das "Ziehen" der Seite auf dem iPhone */
        body { overscroll-behavior-y: contain; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="text-center mb-8 pt-4">
            <h1 class="text-3xl font-black text-yellow-500 uppercase tracking-tighter italic">BTC Strategie-App</h1>
            <p id="last-update" class="text-slate-500 text-xs mt-1 uppercase tracking-widest">Initialisiere...</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="bg-slate-800 p-6 rounded-3xl border-2 border-yellow-500/50 shadow-2xl text-center">
                <span class="text-slate-400 uppercase text-[10px] font-bold tracking-widest">Empfehlung</span>
                <div id="action-today" class="text-5xl font-black mt-1">---</div>
                <div id="amount-today" class="text-lg text-slate-300">0.00 €</div>
            </div>
            <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-xl text-center">
                <span class="text-slate-400 uppercase text-[10px] font-bold tracking-widest">Performance (1J)</span>
                <div id="perf-pct" class="text-5xl font-black mt-1 text-white">0%</div>
                <p id="perf-details" class="text-slate-500 text-[10px] mt-1 italic">Simulation läuft...</p>
            </div>
        </div>

        <div class="bg-slate-800 p-4 rounded-3xl border border-slate-700 shadow-xl mb-6">
            <h2 class="text-sm font-bold mb-4 text-slate-400 uppercase">Technische Analyse</h2>
            <div style="height: 300px;"><canvas id="techChart"></canvas></div>
        </div>

        <div class="bg-slate-800 rounded-3xl border border-slate-700 overflow-hidden shadow-xl mb-6">
            <table class="w-full text-left text-xs">
                <thead class="bg-slate-700 text-slate-400 uppercase text-[10px]">
                    <tr>
                        <th class="p-4">Datum</th>
                        <th class="p-4">Preis</th>
                        <th class="p-4 text-right">Signal</th>
                    </tr>
                </thead>
                <tbody id="table-body" class="divide-y divide-slate-700"></tbody>
            </table>
        </div>

        <div class="bg-slate-800 p-4 rounded-3xl border border-slate-700 shadow-xl">
            <h2 class="text-sm font-bold mb-4 text-green-500 uppercase">Mein 5€ Wachstum</h2>
            <div style="height: 200px;"><canvas id="portfolioChart"></canvas></div>
        </div>
    </div>

    <script>
    async function init() {
        try {
            const response = await fetch('./data.json?t=' + Date.now());
            const data = await response.json();
            
            document.getElementById('last-update').innerText = `Update: ${data.last_update}`;
            
            const latest = data.table[0];
            const actionEl = document.getElementById('action-today');
            actionEl.innerText = latest.signal;
            actionEl.className = `text-5xl font-black mt-1 ${latest.signal === 'KAUFEN' ? 'text-green-400' : 'text-red-400'}`;
            document.getElementById('amount-today').innerText = `Einsatz: ${latest.invest_today}`;

            document.getElementById('perf-pct').innerText = (data.backtest.performance > 0 ? "+" : "") + data.backtest.performance + "%";
            document.getElementById('perf-details').innerText = `${data.backtest.invested}€ ➔ ${data.backtest.current_value}€`;

            // Charts
            new Chart(document.getElementById('techChart'), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        { label: 'BTC', data: data.prices, borderColor: '#f59e0b', borderWidth: 2, pointRadius: 0 },
                        { label: 'MA200', data: data.ma200, borderColor: '#ef4444', borderWidth: 1, pointRadius: 0, borderDash: [5,5] }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('portfolioChart'), {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{ 
                        data: data.portfolio_history, 
                        backgroundColor: 'rgba(34, 197, 94, 0.1)', 
                        borderColor: '#22c55e', 
                        fill: true, 
                        tension: 0.1,
                        pointRadius: 0 
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false } }
                }
            });

            // Tabelle
            const tbody = document.getElementById('table-body');
            data.table.slice(0, 5).forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="p-4">${row.date}</td><td class="p-4 font-mono">${row.price.toLocaleString()}€</td><td class="p-4 text-right ${row.signal === 'KAUFEN' ? 'text-green-400 font-bold' : 'text-slate-500'}">${row.signal}</td>`;
                tbody.appendChild(tr);
            });
        } catch(e) { console.error(e); }
    }
    init();
    </script>
</body>
</html>
