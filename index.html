<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Strategie Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-slate-900 text-slate-100 font-sans">

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8 flex flex-col md:flex-row justify-between items-center border-b border-slate-700 pb-6">
            <div>
                <h1 class="text-3xl font-bold text-yellow-500">Bitcoin Strategie <span class="text-white font-light text-xl">PRO</span></h1>
                <p id="last-update" class="text-slate-400 text-sm italic">Synchronisiere Daten...</p>
            </div>
            <div class="mt-4 md:mt-0 bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                <span class="text-xs uppercase text-slate-500 block">Markt-Status</span>
                <span id="global-rating" class="font-bold text-lg text-yellow-500">Analyse läuft...</span>
            </div>
        </header>

        <div class="bg-slate-800 p-6 rounded-2xl shadow-xl mb-8 border border-slate-700">
            <div style="height: 400px; position: relative;">
                <canvas id="bitcoinChart"></canvas>
            </div>
        </div>

        <div class="bg-slate-800 rounded-2xl shadow-xl border border-slate-700 overflow-hidden">
            <div class="p-6 border-b border-slate-700">
                <h2 class="text-xl font-semibold">Multi-Indikator Historie</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-750 text-slate-400 text-xs uppercase">
                        <tr>
                            <th class="py-4 px-4">Datum</th>
                            <th class="py-4 px-4">Kurs (EUR)</th>
                            <th class="py-4 px-4">RSI (14)</th>
                            <th class="py-4 px-4">Abst. Hoch</th>
                            <th class="py-4 px-4 text-center text-blue-400">MA200 (50%)</th>
                            <th class="py-4 px-4">Score</th>
                            <th class="py-4 px-4">Signal</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-700">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('./data.json?t=' + Date.now());
            const data = await response.json();

            document.getElementById('last-update').innerText = `Update: ${data.last_update}`;
            document.getElementById('global-rating').innerText = data.table[0].rating;

            // Chart
            const ctx = document.getElementById('bitcoinChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        { label: 'BTC', data: data.prices, borderColor: '#f59e0b', borderWidth: 3, tension: 0.2, pointRadius: 3 },
                        { label: 'MA200 (Trend)', data: data.ma200, borderColor: '#ef4444', borderWidth: 2, pointRadius: 0, borderDash: [5, 5] },
                        { label: 'MA50', data: data.ma50, borderColor: '#10b981', borderWidth: 1, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b' } },
                        x: { grid: { display: false }, ticks: { color: '#64748b' } }
                    }
                }
            });

            // Tabelle
            const tbody = document.getElementById('table-body');
            data.table.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-700/50 transition cursor-default";
                
                // RSI Color Logic
                let rsiColor = "text-slate-100";
                if(row.rsi > 70) rsiColor = "text-red-400";
                if(row.rsi < 30) rsiColor = "text-green-400";

                // Signal Color
                const sigBg = row.rating === "KAUFEN" ? "bg-green-500/20 text-green-400" : 
                              row.rating === "HALTEN" ? "bg-yellow-500/20 text-yellow-400" : 
                              "bg-red-500/20 text-red-400";

                tr.innerHTML = `
                    <td class="py-4 px-4 text-sm">${row.date}</td>
                    <td class="py-4 px-4 font-mono font-bold">${row.price.toLocaleString('de-DE')} €</td>
                    <td class="py-4 px-4 ${rsiColor}">${row.rsi}</td>
                    <td class="py-4 px-4 text-slate-400 text-sm">${row.ath_dist}%</td>
                    <td class="py-4 px-4 text-center">${row.ma200_ok === 'Ja' ? '✅' : '❌'}</td>
                    <td class="py-4 px-4 font-semibold">${row.score}%</td>
                    <td class="py-4 px-4"><span class="px-2 py-1 rounded text-xs font-bold ${sigBg}">${row.rating}</span></td>
                `;
                tbody.appendChild(tr);
            });

        } catch (e) { console.error(e); }
    });
    </script>
</body>
</html>
